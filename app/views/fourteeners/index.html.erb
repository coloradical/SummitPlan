<!DOCTYPE html>
<html>
	<head>
		<%= include_gon(:init => true) %>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<style>
		  /* Always set the map height explicitly to define the size of the div
		   * element that contains the map. */
		  #map {
			height: 100%;
		  }
		  /* Optional: Makes the sample page fill the window. */
		  html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		  }
		</style>
	</head>
	<body>
		<h3>Summit Plan</h3>
		<div id="map"></div>
		<script>
			function initMap() {
			var markers = []; //array of markers
			var elbert = {lat: 39.118075, lng: -106.445417};
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 7,
				center: elbert
			});
			var infowindow = new google.maps.InfoWindow();
			gon.fourteeners.forEach(function(fourteener){
				if (fourteener.surname == "Mount") {
					var full_name = fourteener.surname +" " +fourteener.name;
				} else if (fourteener.surname == "Peak"){
					var full_name = fourteener.name + " " +fourteener.surname;
				} else if (fourteener.surname == "Mount of the"){
					var full_name = fourteener.surname +" "+fourteener.name;
				} else if (fourteener.surname == "Mountain"){
					var full_name = fourteener.name +" " +fourteener.surname;
				} else if (fourteener.surname == "Needle"){
					var full_name = fourteener.name +" " +fourteener.surname;
				} else if (fourteener.surname == "Point"){
					var full_name = fourteener.name +" " +fourteener.surname;
				} else {
					var full_name = fourteener.name;
				}
				var marker = new google.maps.Marker({
					position: {lat: fourteener.location_lat, lng: fourteener.location_long},
					map: map,
					title: full_name,
					surname: fourteener.surname,
					elevation_in_feet: fourteener.elevation_in_feet,
					rank: fourteener.rank,
					location_lat: fourteener.location_lat,
					location_long: fourteener.location_long,
					forest: fourteener.forest,
					range: fourteener.range,
					classification: fourteener.classification,
					exposure: fourteener.exposure,
					elevation_gain_in_feet: fourteener.elevation_gain_in_feet,
					round_trip_distance_in_miles: fourteener.round_trip_distance_in_miles,
					no_4wd_additional_elevation_in_feet: fourteener.no_4wd_additional_elevation_in_feet,
					no_4wd_additional_distance_in_miles: fourteener.no_4wd_additional_distance_in_miles,
					route_name: fourteener.route_name,
					trailhead_name: fourteener.trailhead_name,
					trailhead_lat: fourteener.trailhead_lat,
					trailhead_long: fourteener.trailhead_long,
					four_x_four_required: fourteener.four_x_four_required,
					additional_info_url: fourteener.additional_info_url,
					kml: fourteener.kml
				});
				markers.push(marker); //add marker to array of markers
				var contentString = '<div id="content">'+
				  '<div id="siteNotice">'+
				  '</div>'+
				  '<h1 id="firstHeading" class="firstHeading">'+full_name+'</h1>'+
				  '<div id="bodyContent">'+
				  '<p>Elevation: '+marker.elevation_in_feet+' feet</br>'+
				  'Class: '+marker.classification+'</br>'+
				  'Range: '+marker.range+'</br>'+
				  'Forest: '+marker.forest+'</br>'+
				  'Route name: '+marker.route_name+'</br>'+
				  'Trailhead name: '+marker.trailhead_name+'</br>'+
				  'Round trip distance: '+marker.round_trip_distance_in_miles+' miles</br>'+
				  'Elevation gain: '+marker.elevation_gain_in_feet+' feet</br></p>'+
				  '<p>Additional info: <a href=\"'+marker.additional_info_url+'\">'+
				  +'More information'+'</a></p>'+
				  '</div>'+
				  '</div>';
				marker.addListener('click', function() {
					map.setZoom(9);
				    map.setCenter(marker.getPosition());
					infowindow.setContent(contentString);
					infowindow.setPosition(marker.getPosition());
					infowindow.open(marker.get('map'), marker);
				});
				});
			}
			//add KML to database
			//jquery ajax 
			//change color or something based on class
			//change link to profile page not fourteeners page 
			//look into one infowindow closes when you open another
		</script>
		<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBYkGDkbDQBSWK4WoQM-r8tA5WXkqu_Rw&callback=initMap">
		</script>
	</body>
</html>